<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Detail - DzyyStore</title>
    <link rel="stylesheet" href="src/assets/css/output.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-white min-h-screen flex flex-col">
    <!-- Header -->
    <header class="bg-white shadow-sm py-3 px-4 sticky top-0 z-50">
        <div class="container mx-auto flex items-center justify-between">
            <div class="flex items-center gap-4">
                <a href="home.html" class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors">
                    <i class="ri-arrow-left-s-line text-xl text-gray-700"></i>
                </a>
                <img src="src/assets/images/logo-search-grid-2x (1).png" alt="Logo" width="10%" height="10%" style="border-radius: 10%;">
            </div>
            
            <div class="relative w-1/3">
                <input type="text" placeholder="Cari produk..." class="w-full py-2 px-4 pr-10 border border-gray-200 rounded-full text-sm focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary">
                <div class="absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 flex items-center justify-center text-gray-400">
                    <i class="ri-search-line"></i>
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                <button class="w-10 h-10 flex items-center justify-center text-gray-700 hover:text-primary relative">
                    <i class="ri-notification-3-line text-xl"></i>
                </button>
                <button id="cartButton" class="w-10 h-10 flex items-center justify-center text-gray-700 hover:text-primary relative">
                    <i class="ri-shopping-cart-2-line text-xl"></i>
                    <span id="cartCount" class="cart-badge"></span>
                </button>
                <button class="w-10 h-10 flex items-center justify-center text-gray-700 hover:text-primary">
                    <i class="ri-user-3-line text-xl"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Cart Modal -->
    <div id="modalBackdrop" class="modal-backdrop"></div>
    <div id="cartModal" class="cart-modal">
        <div class="cart-content">
            <div class="cart-header">
                <h2 class="text-lg font-semibold">Keranjang</h2>
                <button id="closeCart" class="text-gray-500 hover:text-gray-700">
                    <i class="ri-close-line text-xl"></i>
                </button>
            </div>
            <div id="cartContent"></div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="flex-grow py-6 px-4">
        <div class="container mx-auto">
            <!-- Product Section -->
            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Product Images -->
                <div class="w-full lg:w-3/5">
                    <div class="border border-gray-100 rounded-lg p-4 mb-4">
                        <img id="mainImage" src="" alt="Product Image" class="w-full h-[500px] object-contain rounded">
                    </div>
                </div>
                
                <!-- Product Details -->
                <div class="w-full lg:w-2/5">
                    <h1 id="productTitle" class="text-2xl font-bold mb-4"></h1>
                    
                    <div class="flex flex-col gap-4 mb-6">
                        <div class="flex items-center gap-2">
                            <span class="text-gray-600">Kategori:</span>
                            <span id="productCategory" class="font-medium"></span>
                        </div>
                        
                        <div class="flex items-center gap-2">
                            <span class="text-gray-600">Rating:</span>
                            <div class="flex items-center">
                                <div id="productRating" class="flex text-yellow-400 text-sm mr-1"></div>
                                <span id="ratingCount" class="text-sm text-gray-500"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg mb-6">
                        <p id="productDescription" class="text-gray-700"></p>
                    </div>
                    
                    <!-- Purchase Options Panel -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h3 class="font-medium mb-4">Atur Jumlah Dan Catatan</h3>
                        
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center">
                                <button onclick="updateQuantity(-1)" class="w-8 h-8 flex items-center justify-center border border-gray-200 rounded-l-button !rounded-button text-gray-500 hover:bg-gray-50 whitespace-nowrap">
                                    <i class="ri-subtract-line"></i>
                                </button>
                                <input id="quantity" type="number" value="1" min="1" class="w-12 h-8 border-y border-gray-200 text-center text-gray-800 focus:outline-none border-none">
                                <button onclick="updateQuantity(1)" class="w-8 h-8 flex items-center justify-center border border-gray-200 rounded-r-button !rounded-button text-gray-500 hover:bg-gray-50 whitespace-nowrap">
                                    <i class="ri-add-line"></i>
                                </button>
                            </div>
                            
                            <div class="text-sm text-gray-600">
                                Stok: <span id="stockCount">999</span>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center border-t border-gray-200 pt-4 mb-4">
                            <span class="text-gray-600">Subtotal:</span>
                            <span id="subtotal" class="text-xl font-bold"></span>
                        </div>
                        
                        <div class="flex flex-col gap-3">
                            <div class="flex gap-3">
                                <button onclick="buyNow(currentProduct)" class="flex-1 py-2 px-4 border border-primary text-primary font-medium rounded-button hover:bg-primary/5 whitespace-nowrap">Beli Langsung</button>
                                <button onclick="addToCartFromDetail()" class="flex-1 py-2 px-4 bg-primary text-white font-medium rounded-button hover:bg-primary/90 whitespace-nowrap">+ Keranjang</button>
                            </div>
                            <a href="home.html" class="block text-center py-2 px-4 bg-gray-100 text-gray-700 font-medium rounded-button hover:bg-gray-200 transition-colors">
                                <i class="ri-arrow-left-line mr-1"></i> Kembali ke Home
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-primary text-white mt-12">
        <div class="container mx-auto py-10 px-4">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <div>
                    <h3 class="font-bold text-lg mb-4">Tentang Kami</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="hover:underline">Tentang DzyyStore</a></li>
                        <li><a href="#" class="hover:underline">Karier</a></li>
                        <li><a href="#" class="hover:underline">Blog</a></li>
                        <li><a href="#" class="hover:underline">Syarat & Ketentuan</a></li>
                        <li><a href="#" class="hover:underline">Kebijakan Privasi</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="font-bold text-lg mb-4">Bantuan</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="hover:underline">Pusat Bantuan</a></li>
                        <li><a href="#" class="hover:underline">Hubungi Kami</a></li>
                        <li><a href="#" class="hover:underline">Cara Berbelanja</a></li>
                        <li><a href="#" class="hover:underline">Pengiriman</a></li>
                        <li><a href="#" class="hover:underline">Pengembalian</a></li>
                    </ul>
                </div>
            </div>
            <div class="mt-8 pt-8 border-t border-white/20">
                <p class="text-center">Â© 2025 DzyyStore. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="src/assets/js/main.js"></script>
    <script>
        let currentProduct = null;

        // Function to generate star rating HTML
        function generateStarRating(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            let stars = '';
            
            for (let i = 0; i < 5; i++) {
                if (i < fullStars) {
                    stars += '<i class="ri-star-fill"></i>';
                } else if (i === fullStars && hasHalfStar) {
                    stars += '<i class="ri-star-half-fill"></i>';
                } else {
                    stars += '<i class="ri-star-line"></i>';
                }
            }
            return stars;
        }

        // Function to update quantity
        function updateQuantity(change) {
            const quantityInput = document.getElementById('quantity');
            const currentQuantity = parseInt(quantityInput.value);
            const newQuantity = Math.max(1, currentQuantity + change);
            quantityInput.value = newQuantity;
            updateSubtotal();
        }

        // Function to update subtotal
        function updateSubtotal() {
            const quantity = parseInt(document.getElementById('quantity').value);
            const price = currentProduct ? currentProduct.price : 0;
            const subtotal = quantity * price * 15000; // Convert to IDR
            document.getElementById('subtotal').textContent = `Rp ${subtotal.toLocaleString('id-ID')}`;
        }

        // Function to add to cart from detail page
        function addToCartFromDetail() {
            if (currentProduct) {
                const quantity = parseInt(document.getElementById('quantity').value);
                for (let i = 0; i < quantity; i++) {
                    addToCart(currentProduct);
                }
            }
        }

        // Function to fetch and display product details
        async function fetchProductDetails() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const productId = urlParams.get('id');
                
                if (!productId) {
                    window.location.href = 'index.html';
                    return;
                }

                const response = await fetch(`https://fakestoreapi.com/products/${productId}`);
                const product = await response.json();

                // Store current product
                currentProduct = product;

                // Update page title
                document.title = `${product.title} - DzyyStore`;

                // Update product details
                document.getElementById('mainImage').src = product.image;
                document.getElementById('mainImage').alt = product.title;
                document.getElementById('productTitle').textContent = product.title;
                document.getElementById('productCategory').textContent = product.category;
                document.getElementById('productDescription').textContent = product.description;
                document.getElementById('productRating').innerHTML = generateStarRating(product.rating.rate);
                document.getElementById('ratingCount').textContent = `(${product.rating.count})`;

                // Initialize subtotal
                updateSubtotal();

            } catch (error) {
                console.error('Error fetching product details:', error);
                // Handle error (e.g., show error message or redirect)
            }
        }

        // Function to handle direct checkout from product detail
        function buyNow(product) {
            if (!isUserLoggedIn()) {
                redirectToLogin();
                return;
            }
            localStorage.setItem('checkoutItem', JSON.stringify(product));
            window.location.href = 'checkout.html';
        }

        // Load product details and cart when page loads
        document.addEventListener('DOMContentLoaded', () => {
            fetchProductDetails();
            loadCart(); // Load cart from localStorage
        });
    </script>
</body>
</html>